version: '3.8'

services:
  tpp-api-simulator:
    build: .
    container_name: bb-tpp-api-simulator
    ports:
      - "3002:3002"
    environment:
      - PORT=3002
      - PRIORA_URL=${PRIORA_URL:-priora.saltedge.com}
      - PROTOCOL=${PROTOCOL:-https}
      - OB_PROVIDER_CODE=${OB_PROVIDER_CODE:-backbase_dev_uk}
      - OB_SOFTWARE_ID=${OB_SOFTWARE_ID}
      - OB_PRIVATE_KEY_PATH=/app/keys/private_key.pem
      - REDIRECT_URI=${REDIRECT_URI:-https://backbase-dev.com/callback}
    volumes:
      # Mount your private key from host
      - ./private_key.pem:/app/keys/private_key.pem:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3002/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

